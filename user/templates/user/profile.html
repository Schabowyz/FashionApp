{% extends "layout_main.html" %}

{% load socialaccount %}

{% load static %}

{% block title %}Profile{% endblock %}

{% block body %}

    <link href="{% static 'user/profile.css' %}" rel="stylesheet">

    <div class="navbar-space"></div>
        
    <div class="container">
        <div class="row">
            <h7>PROFILE PAGE</h7><br><br>
        </div>
        <div class="row">
            <div class="col-lg-3 order-1">
                <div class="flex">
                    <!-- USER INFO -->
                    <div>
                        <p>
                            <h7>INFORMATION:</h7>
                            <button class="edit-button" type="button" data-bs-toggle="modal" data-bs-target="#modal_info">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                                    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                                </svg>
                            </button>
                        </p>
                    </div>
                    <div>
                        <table>
                            <tr>
                                <td>name:</td>
                                <td class="text-end">{{ request.user.first_name }}</td>
                            </tr>
                            <tr>
                                <td>surname:</td>
                                <td class="text-end">{{ request.user.last_name }}</td>
                            </tr>
                        </table>
                    </div>
                    <hr class="dropdown-divider">
                    <!-- USER CONTACT -->
                    <div>
                        <p>
                            <h7>CONTACT:</h7>
                            <button class="edit-button" type="button" data-bs-toggle="modal" data-bs-target="#modal_contact">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                                    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                                </svg>
                            </button>
                        </p>
                    </div>
                    <div>
                        <table>
                            <tr>
                                <td>email:</td>
                                <td class="text-end">{{ request.user.email }}</td>
                            </tr>
                        </table>
                    </div>
                    <hr class="dropdown-divider">
                    {% get_social_accounts user as accounts %}
                    {% if not accounts %}
                    <!-- USER SECURITY -->
                        <div>
                            <p>
                                <h7>SECURITY:</h7>
                                <button class="edit-button" type="button" data-bs-toggle="modal" data-bs-target="#modal_security">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                        <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                                        <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                                    </svg>
                                </button>
                            </p>
                        </div>
                        <div>
                            <table>
                                <tr>
                                    <td>password:</td>
                                    <td class="text-end">********</td>
                                </tr>
                            </table>
                        </div>
                        <hr class="dropdown-divider">
                    {% endif %}
                    <!-- USER ADDRESS -->
                    <div>
                        <p><h7>ADDRESS:</h7>
                            <button class="edit-button" type="button" data-bs-toggle="modal" data-bs-target="#modal_address">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                                    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                                </svg>
                            </button>
                        </p>
                    </div>
                    <table>
                        <tr>
                            <td>street:</td>
                            <td class="text-end">{{ user_address.street }}</td>
                        </tr>
                        <tr>
                            <td>house number:</td>
                            <td class="text-end">{{ user_address.number }}</td>
                        </tr>
                        <tr>
                            <td>postal code:</td>
                            <td class="text-end">{{ user_address.postal }}</td>
                        </tr>
                        <tr>
                            <td>city:</td>
                            <td class="text-end">{{ user_address.city }}</td>
                        </tr>
                        <tr>
                            <td>country:</td>
                            <td class="text-end">{{ user_address.country }}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="col-lg-9 top-padding order-2">
                <div>
                    <p><h7>ORDER HISTORY:</h7></p>
                </div>
                <hr class="dropdown-divider">
                {% for order in orders %}
                    <table>
                        <tbody>
                            <tr>
                                <td class="fixed-width-small" scope="col">id-{{ order.order_info.id }}</td>
                                <td class="fixed-width-big" scope="col">{{ order.order_info.first_name }} {{ order.order_info.last_name }}</td>
                                <td class="fixed-width-big" scope="col">{{ order.order_info.date }}</td>
                                <td class="fixed-width-big" scope="col">{{ order.order_info.status }}</td>
                                <td class="fixed-width-small" scope="col">{{ order.order_info.overall_price|floatformat:2 }} €</td>
                                <td class="fixed-width-small" scope="col">
                                    <a data-bs-toggle="collapse" href="#collapse{{ order.order_info.id }}" role="button" aria-expanded="false" aria-controls="collapse{{ order.order_info.id }}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-down" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/>
                                        </svg>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="collapse" id="collapse{{ order.order_info.id }}">
                        <div class="card card-body">
                            {% for item in order.order_items %}
                                <hr class="dropdown-divider">
                                <div class="row">
                                    <div class="col margins">
                                        <div class="row">
                                            <table>
                                                <tr>
                                                    <td>item:</td>
                                                    <td class="text-end"><a class="no-decorator" href="{% url 'items:product' item_id=item.item_id.id %}">{{ item.item_id.name }}</a></td>
                                                </tr>
                                                <tr>
                                                    <td>gender:</td>
                                                    <td class="text-end">{{ item.item_id.gender }}</td>
                                                </tr>
                                                <tr>
                                                    <td>category:</td>
                                                    <td class="text-end">{{ item.item_id.category }}</td>
                                                </tr>
                                                <tr>
                                                    <td>quantity:</td>
                                                    <td class="text-end">{{ item.quantity }}</td>
                                                </tr>
                                                <tr>
                                                    <td>piece price:</td>
                                                    <td class="text-end">{{ item.price_piece|floatformat:2 }} €</td>
                                                </tr>
                                                <tr>
                                                    <td>overall price:</td>
                                                    <td class="text-end">{{ item.overall_price|floatformat:2 }} €</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col item-image">
                                        <a href="{% url 'items:product' item_id=item.item_id.id %}">
                                            <img src="{{ item.item_id.image.url }}" alt="{{ item.item_id.name }}">
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    <hr class="dropdown-divider">
                {% endfor %}
            </div>

        </div>
    </div>

    <!-- INFO MODAL -->
    <div class="modal fade" id="modal_info" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">USER INFORMATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'user:info' %}" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="input-first_name" class="form-label">first name:</label>
                        <input id="input-first_name" type="text" class="form-control" name="first_name" placeholder="first name" value="{{ request.user.first_name }}">
                    </div>
                    <div class="mb-3">
                        <label for="input-last_name" class="form-label">last name:</label>
                        <input id="input-last_name" type="text" class="form-control" name="last_name" placeholder="last name" value="{{ request.user.last_name }}">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-secondary">save</button>
                </div>
            </form>
        </div>
        </div>
    </div>

    <!-- CONTACT MODAL -->
    <div class="modal fade" id="modal_contact" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">CONTACT</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'user:email' %}" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="input-email" class="form-label">email address:</label>
                        <input id="input-email" type="email" class="form-control" name="email" placeholder="email address" value="{{ request.user.email }}">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-secondary">save</button>
                </div>
            </form>
        </div>
        </div>
    </div>

    <!-- SECURITY MODAL -->
    <div class="modal fade" id="modal_security" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">PASSWORD</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'user:password' %}" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="input-first_name" class="form-label">password:</label>
                        <input id="input-first_name" type="password" class="form-control" name="password" placeholder="password">
                    </div>
                    <div class="mb-3">
                        <label for="input-last_name" class="form-label">repeat password:</label>
                        <input id="input-last_name" type="password" class="form-control" name="repeat_password" placeholder="repeat password">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-secondary">save</button>
                </div>
            </form>
        </div>
        </div>
    </div>

    <!-- ADDRESS MODAL -->
    <div class="modal fade" id="modal_address" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">ADDRESS INFORMATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="{% url 'user:address' %}" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="input-street" class="form-label">street:</label>
                        <input id="input-street" type="text" class="form-control" name="street" placeholder="street" value="{{ user_address.street }}">
                    </div>
                    <div class="mb-3">
                        <label for="input-number" class="form-label">house number:</label>
                        <input id="input-number" type="text" class="form-control" name="number" placeholder="house number" value="{{ user_address.number }}">
                    </div>
                    <div class="mb-3">
                        <label for="input-postal" class="form-label">postal code:</label>
                        <input id="input-postal" type="number" class="form-control no-arrows" name="postal" placeholder="postal code" value="{{ user_address.postal }}">
                    </div>
                    <div class="mb-3">
                        <label for="input-city" class="form-label">city:</label>
                        <input id="input-city" type="text" class="form-control" name="city" placeholder="city" value="{{ user_address.city }}">
                    </div>
                    <div class="mb-3">
                        <label for="input-country" class="form-label">country:</label>
                        <input id="input-country" type="text" class="form-control" name="country" placeholder="country" value="{{ user_address.country }}">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-secondary">save</button>
                </div>
            </form>
        </div>
        </div>
    </div>

{% endblock %}